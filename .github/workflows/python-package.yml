name: Python Package (Docker)

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build-and-test:
    # Run on an Ubuntu server that has Docker
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-latest, macos-latest, windows-latest]

    steps:
      # 1. Download your code (including the Dockerfile)
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2. Build the Docker image
      #    Following the instructions in your Dockerfile
      #    and "tags" it as 'my-app'
      - name: Build Docker image
        run: docker build -t my-app .

      # 3. Run Linting INSIDE the container
      #    Starts the container and gives it the 'flake8 .' command
      #    (Make sure flake8 is in requirements.txt)
      - name: Lint with flake8
        run: docker run my-app flake8 .

      # 4. Run Tests INSIDE the container
      #    Starts another container and gives it the 'pytest' command
      #    (Make sure pytest is in requirements.txt)
      - name: Test with pytest
        run: docker run my-app pytest